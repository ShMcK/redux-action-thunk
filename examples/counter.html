<!DOCTYPE html>
<html>

<head>
	<title>Redux basic example</title>
	<script src="https://npmcdn.com/redux@latest/dist/redux.min.js"></script>
</head>

<body>
	<div>
		<p>
			Clicked: <span id="value">0</span> times
			<button id="increment">+</button>
			<button id="decrement">-</button>
			<button id="incrementIfOdd">Increment if odd</button>
			<button id="incrementAsync">Increment async</button>
		</p>
	</div>
	<script>
		function counter(state, action) {
			if (typeof state === 'undefined') {
				return 0
			}

			switch (action.type) {
				case 'INCREMENT':
					return state + 1
				case 'DECREMENT':
					return state - 1
				default:
					return state
			}
		}

		class Red {
			constructor() {
				this.actions = {};
			}
			addAction(name, action) {
				if (!this.actions[name]) {
					this.actions[name] = action;
				} else {
					console.log(`Warning: key "${key}" already exists on "${target}".`);
				}
			}
		}
		const red = new Red();

    function createRedMiddleware() {
			return ({
				action,
				dispatch,
				getState
			}) => next => a => {
				if (typeof a === 'function') {
					return action(action, dispatch, getState);
				}
				return next(red.actions[a]);
			};
		}

		const redMiddleware = createRedMiddleware();


		red.addAction('increment', {
			type: 'INCREMENT'
		});
		red.addAction('decrement', {
			type: 'DECREMENT'
		});


		var applyMiddleware = Redux.applyMiddleware
		var store = Redux.createStore(counter, applyMiddleware(redMiddleware))
		var valueEl = document.getElementById('value')

		function render() {
			valueEl.innerHTML = store.getState().toString()
		}

		render()
		store.subscribe(render)

		document.getElementById('increment')
			.addEventListener('click', function() {
				store.dispatch('increment')
			})

		document.getElementById('decrement')
			.addEventListener('click', function() {
				store.dispatch('decrement')
			})

		document.getElementById('incrementIfOdd')
			.addEventListener('click', function() {
				if (store.getState() % 2 !== 0) {
					store.dispatch('increment')
				}
			})

		document.getElementById('incrementAsync')
			.addEventListener('click', function() {
				setTimeout(function() {
					store.dispatch('increment')
				}, 1000)
			})
	</script>
</body>

</html>
